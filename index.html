<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>뱅크랩 API 명세서</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            mint: {
              50: '#F0F7F7',
              100: '#E6F2F2',
              200: '#D4EAEA',
              300: '#C0E1E1',
              400: '#A8CDCD',
              500: '#6EC7C7',
              600: '#52B9B9',
            },
            beige: '#F6F5F2',
            ink: '#1F2937',
            line: '#D9E3E3',
          },
          boxShadow: { soft: '0 10px 30px rgba(2, 8, 23, 0.06)' },
          fontFamily: {
            mono: [
              'ui-monospace',
              'SFMono-Regular',
              'Menlo',
              'Consolas',
              'monospace',
            ],
          },
        },
      },
    };
  </script>
  <style>
    pre.code-json {
      white-space: pre;
      word-break: normal;
      tab-size: 2;
    }

    .t-key {
      color: #f3b509;
    }

    .t-string {
      color: #07d090;
    }

    .t-number {
      color: #db2778d5;
    }

    .t-boolean {
      color: #b45309;
    }

    .t-null {
      color: #6b7280;
    }

    .t-colon {
      color: #94a3b8;
    }

    .t-punct {
      color: #94a3b8;
    }

    .t-quote {
      color: #9ca3af;
    }
  </style>
</head>

<body class="bg-beige text-ink">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/70 backdrop-blur border-b border-line">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <h1 class="text-2xl font-semibold">
        <a href="#" onclick="window.location.href = window.location.pathname + window.location.search; return false;">
          뱅크랩 API 명세서
        </a>
      </h1>
      <span class="text-sm text-gray-500">v1</span>
    </div>
  </header>

  <!-- Body -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Sidebar -->
    <aside class="lg:col-span-3">
      <div class="bg-white rounded-xl shadow-soft border border-line">
        <div class="p-4 border-b border-line font-medium">목차</div>
        <nav id="toc" class="p-2 space-y-1"></nav>
      </div>
    </aside>

    <!-- Content -->
    <section id="content" class="lg:col-span-9 space-y-8"></section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-line bg-white/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-gray-500">
      © 2025 Banklab – API v1
    </div>
  </footer>

  <!-- RENDERER -->
  <script>
    // --- Utilities ---
    function escapeHTML(str) {
      return str.replace(
        /[&<>"\']/g,
        (s) =>
        ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': '"',
          "'": "&#39;",
        }[s])
      );
    }
    const IND = '  ';
    function renderJSONValue(v, depth, comma) {
      if (v === null)
        return `<span class="t-null">null</span>${comma ? ',' : ''}`;
      if (Array.isArray(v)) {
        if (!v.length)
          return `<span class="t-punct">[ ]</span>${comma ? ',' : ''}`;
        let out = `<span class="t-punct">[</span>\n`;
        v.forEach((item, i) => {
          out +=
            IND.repeat(depth + 1) +
            renderJSONValue(item, depth + 1, i !== v.length - 1) +
            '\n';
        });
        out +=
          IND.repeat(depth) +
          `<span class="t-punct">]</span>${comma ? ',' : ''}`;
        return out;
      }
      if (typeof v === 'object') {
        const keys = Object.keys(v);
        if (!keys.length)
          return `<span class="t-punct">{ }</span>${comma ? ',' : ''}`;
        let out = `<span class="t-punct">{</span>\n`;
        keys.forEach((k, i) => {
          out +=
            IND.repeat(depth + 1) +
            `<span class="t-quote">"</span><span class="t-key">${escapeHTML(
              k
            )}</span><span class="t-quote">"</span>` +
            `<span class="t-colon">: </span>` +
            renderJSONValue(v[k], depth + 1, i !== keys.length - 1) +
            '\n';
        });
        out +=
          IND.repeat(depth) +
          `<span class="t-punct">}</span>${comma ? ',' : ''}`;
        return out;
      }
      if (typeof v === 'string') {
        return `<span class="t-quote">"</span><span class="t-string">${escapeHTML(
          v
        )}</span><span class="t-quote">"</span>${comma ? ',' : ''}`;
      }
      if (typeof v === 'number')
        return `<span class="t-number">${String(v)}</span>${comma ? ',' : ''
          }`;
      if (typeof v === 'boolean')
        return `<span class="t-boolean">${v}</span>${comma ? ',' : ''}`;
      return `<span>${escapeHTML(v)}</span>${comma ? ',' : ''}`;
    }
    function highlightJSON(json) {
      const obj = typeof json === 'string' ? JSON.parse(json) : json;
      return renderJSONValue(obj, 0, false);
    }

    // data-json 렌더 (그대로 사용 가능)
    document.querySelectorAll('pre.code-json[data-json]').forEach((el) => {
      try {
        const raw = el.getAttribute('data-json');
        el.innerHTML = highlightJSON(raw);
        el.classList.add('font-mono', 'text-sm');
      } catch (e) {
        el.textContent = 'JSON 파싱 오류: ' + e.message;
      }
    });
    function createTable(headers, rows) {
      const table = document.createElement('table');
      table.className =
        'w-full text-sm border border-line rounded-lg overflow-hidden table-fixed';
      table.innerHTML = `\n        <thead class="bg-mint-50">\n          <tr>${headers
        .map(
          (h) =>
            `<th class='text-left px-3 py-2 border-b border-line'>${h}</th>`
        )
        .join('')}</tr>\n        </thead>\n        <tbody>${rows
          .map(
            (r) =>
              `<tr>${r
                .map(
                  (c, i) =>
                    `<td class='px-3 py-2 border-b border-line ${i === 0 ? 'font-mono' : ''
                    }'>${c}</td>`
                )
                .join('')}</tr>`
          )
          .join('')}</tbody>`;
      return table;
    }

    // --- Render from JSON ---
    async function render() {
      const toc = document.getElementById('toc');
      const content = document.getElementById('content');
      toc.innerHTML = '';
      content.innerHTML = '';

      try {
        const manifestRes = await fetch('api/manifest.json');
        if (!manifestRes.ok) throw new Error(`manifest.json 로드 실패: ${manifestRes.statusText}`);
        const manifest = await manifestRes.json();

        const data = { categories: [] };

        for (const category of manifest.categories) {
          const apiPromises = category.apis.map(apiId => fetch(`api/${category.path}/${apiId}.json`).then(res => {
            if (!res.ok) throw new Error(`${apiId}.json 로드 실패: ${res.statusText}`);
            return res.json();
          }));
          const apis = await Promise.all(apiPromises);
          data.categories.push({
            name: category.name,
            apis: apis
          });
        }

        renderContent(data);

      } catch (error) {
        console.error("API 명세서를 불러오는 중 오류가 발생했습니다:", error);
        content.innerHTML = `<div class="p-6 bg-red-100 text-red-700 rounded-lg"><strong>오류:</strong> API 명세 데이터를 불러올 수 없습니다. 자세한 내용은 콘솔을 확인하세요.</div>`;
      }
    }

    function renderContent(data) {
      const toc = document.getElementById('toc');
      const content = document.getElementById('content');

      data.categories.forEach((cat, ci) => {
        // Sidebar accordion
        const wrap = document.createElement('div');
        wrap.className = 'border-b border-line';
        const btn = document.createElement('button');
        btn.className =
          'w-full flex items-center justify-between px-3 py-2 hover:bg-mint-50 rounded-lg';
        btn.innerHTML = `<span class='font-medium'>${escapeHTML(cat.name)}</span><svg class='w-4 h-4 transition-transform' viewBox='0 0 20 20' fill='currentColor'><path fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z' clip-rule='evenodd'/></svg>`;
        const list = document.createElement('div');
        list.className = 'pl-3 pb-3 hidden';
        cat.apis.forEach((api) => {
          const a = document.createElement('a');
          a.className = 'block px-3 py-1.5 rounded hover:bg-mint-50';
          a.href = `#api-${api.id}`;
          a.textContent = api.title;
          list.appendChild(a);
        });
        btn.addEventListener('click', () => {
          list.classList.toggle('hidden');
          btn.classList.toggle('acc-rot');
        });
        wrap.appendChild(btn);
        wrap.appendChild(list);
        toc.appendChild(wrap);

        // Content articles
        cat.apis.forEach((api) => {
          const art = document.createElement('article');
          art.id = `api-${api.id}`;
          art.className = 'bg-white rounded-2xl shadow-soft border border-line';
          art.innerHTML = `\n            <header class='p-6 border-b border-line space-y-3'>\n              <p class='text-sm text-gray-500'>${escapeHTML(cat.name)}</p>\n              <h2 class='text-2xl font-semibold'>${escapeHTML(api.title)}</h2>\n              ${api.description
            ? `<p class='text-gray-600 leading-relaxed'>${escapeHTML(
              api.description
            )}</p>`
            : ''
            }\n              <div class='mt-4 space-y-3'>\n                <div class='rounded-lg border border-line bg-mint-50/40 px-4 py-3 w-full'>\n                  <span class='block text-sm font-medium text-gray-500 mb-1'>HTTP Method</span>\n                  <span class='inline-flex items-center px-2.5 py-1 rounded-lg bg-white border border-mint-200 font-semibold'>${escapeHTML(
              api.method
            )}</span>\n                </div>\n                <div class='rounded-lg border border-line bg-mint-50/40 px-4 py-3 w-full'>\n                  <span class='block text-sm font-medium text-gray-500 mb-1'>Endpoint</span>\n                  <code class='font-mono text-sm bg-white border border-mint-200 rounded px-2 py-1'>${escapeHTML(
              api.endpoint
            )}</code>\n                </div>\n              </div>\n            </header>\n            <div class='divide-y divide-line'>\n              <section class='p-6 space-y-6'>\n                <h3 class='text-lg font-semibold'>Request</h3>\n                <div class='space-y-6'>\n                  <div>\n                    <h4 class='font-medium mb-2'>Headers</h4>\n                    <div class='overflow-x-auto' id='tbl-h-${api.id}'></div>\n                  </div>\n                  <div>\n                    <h4 class='font-medium mb-2'>Parameters (Body)</h4>\n                    <div class='overflow-x-auto' id='tbl-p-${api.id}'></div>\n                  </div>\n                </div>\n                ${api.requestExample !== null
              ? `<div><h4 class='font-medium mb-2'>Request Example</h4><pre class='code-json bg-beige p-4 rounded-lg border border-line overflow-x-auto' id='req-${api.id}'></pre></div>`
              : ''
            }\n              </section>\n              <section class='p-6 space-y-4'>\n                <h3 class='text-lg font-semibold'>Response</h3>\n                <div class='space-y-2' id='reslist-${api.id}'></div>\n                ${api.responseExample
              ? `<div><h4 class='font-medium mb-2'>Response Example</h4><pre class='code-json bg-beige p-4 rounded-lg border border-line overflow-x-auto' id='res-${api.id}'></pre></div>`
              : ''
            }\n              </section>\n              <section class='p-6 space-y-2'>\n                <h3 class='text-lg font-semibold'>Example</h3>\n                ${api.curlExample
              ? `<pre class='bg-black text-gray-100 p-4 rounded-lg overflow-x-auto font-mono text-sm'><code>${escapeHTML(
                api.curlExample
              )}</code></pre>`
              : ''
            }\n              </section>\n            </div>`;
          content.appendChild(art);

          // Fill tables
          const hRows = (api.headers || []).map((h) => [
            `<span class='font-mono'>${escapeHTML(h.name || '')}</span>`,
            escapeHTML(h.value || ''),
            h.required ? 'O' : 'X',
            escapeHTML(h.description || ''),
          ]);
          document
            .getElementById(`tbl-h-${api.id}`)
            .appendChild(
              createTable(
                ['Name', 'Value', 'Required', 'Description'],
                hRows.length ? hRows : [['-', '-', '-', '-']]
              )
            );

          const pRows = (api.parameters || []).map((p) => [
            `<span class='font-mono'>${escapeHTML(p.name || '')}</span>`,
            escapeHTML(p.type || ''),
            p.required ? 'O' : 'X',
            escapeHTML(p.description || ''),
          ]);
          document
            .getElementById(`tbl-p-${api.id}`)
            .appendChild(
              createTable(
                ['Name', 'Type', 'Required', 'Description'],
                pRows.length ? pRows : [['-', '-', '-', '-']]
              )
            );

          // Status list
          const resWrap = document.getElementById(`reslist-${api.id}`);
          (api.responses || []).forEach((r) => {
            const div = document.createElement('div');
            div.className =
              'border border-line rounded-lg p-4 bg-mint-50/30 flex items-start gap-3';
            div.innerHTML = `<span class='font-mono text-sm px-2 py-0.5 rounded border border-line bg-white'>${escapeHTML(
              r.status || ''
            )}</span><p class='text-sm'>${escapeHTML(r.description || '')}</p>`;
            resWrap.appendChild(div);
          });

          // JSON examples
          if (api.requestExample !== null) {
            const req = document.getElementById(`req-${api.id}`);
            req.innerHTML = highlightJSON(api.requestExample);
            req.classList.add('font-mono', 'text-sm');
          }
          if (api.responseExample) {
            const res = document.getElementById(`res-${api.id}`);
            res.innerHTML = highlightJSON(api.responseExample);
            res.classList.add('font-mono', 'text-sm');
          }
        });
      });
    }

    // Smooth scroll
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[href^="#api-"]');
      if (!a) return;
      e.preventDefault();
      document
        .querySelector(a.getAttribute('href'))
        ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    render();
  </script>

</body>

</html>